[%- pagetitle = 'PLUGIN_SQUEEZEDSP_MODULEDESC' | string; pageicon = 'PLUGIN_SQUEEZEDSP_MODULEDESC' -%]
[%- pwd_list = BLOCK -%]/
	<a href="[% webroot %]plugins/SqueezeDSP/index.html?player=[% player | uri %]">
		[% "PLUGIN_SQUEEZEDSP_DISPLAYNAME" | string %]
	</a>
[% END -%]
[% PROCESS pageheader.html %]

<!--
	Settings page
	
	This page is part of the SqueezeDSP plugin, https://github.com/Foxenfurter/SqueezeDSP
	and was licensed to you under the terms described in "Plugin.pm"

	Modified by Jonathan Fox 2022
-->

<!-- Script for the model -->
<script type="text/javascript" src="/html/prototype.js"></script>

<!--Now let's split out the libraries and stylese-->
<link rel="stylesheet" type="text/css" href="./squeezedsp_style.css"/>
<!--script type="text/javascript" src="./squeezedsp_data.js"></script>
<script type="text/javascript" src="./squeezedsp_controls.js"></script-->

<script type="text/javascript" >
/*---------------------------------------------------

SqueezeDSP Display logic
-----------------------------------------------------*/
function LocalBuildLists(data)
{
		LocalBuildList ('Filter',data);
		LocalBuildList ('Matrix',data);
		LocalBuildList ('Preset',data);
}


function LocalBuildList (listType, data)
{
		// Get the dropdown Object e.g. sel_Matrix
	    var select = document.getElementById("sel_" + listType);
		// Reset the dropdown list so that only the first element is displayed.
		select.options.length = 1;	
		//loop through the data elements for the list type e.g. Matrix_loop
		var loop = data.result[ listType + "_loop" ];
		if( typeof loop=="object" )
		{
			
			for( var j=0; j<loop.length; j++ )
			{
				var opt = loop[j][0];
				var el = document.createElement("option");
				el.textContent = opt;
				el.value = opt;
				el.textContent = opt.replace(".wav", "", "i");
				select.appendChild(el);
						
			}
		}
		//return (listType);
}



function LocalbuildEQ(data, labeltype)
{
	// we are going to build a set of slider controls from the data passed in
	var myHTML = "";
	var i = 0;
	for(var i in data)
	{
		var lfg = data[i];
		for(var j in lfg)
		{
			// F=frequency, g=gain
			var f = parseFloat(j);
			var g = parseFloat(lfg[j]);
			if( !isNaN(f) && !isNaN(g) )
			{

				
				//style="visibility:hidden"
				myHTML = myHTML + '<TR  id="control_' +  labeltype + i + '" >';
				myHTML = myHTML + '<TD class="rowTitle"><Output style="visibility:hidden; width: 1px;" id="band_' + labeltype + i + '" >' + i  
				myHTML = myHTML + '</Output><Output id="freq_' + labeltype + i + '" >' + f + '</Output>'
				myHTML = myHTML + '&nbsp;Hz</TD>';
				myHTML = myHTML + '<TD class="Slide">';
				myHTML = myHTML + '<input  class="range" type="range" orient="horizontal"  min="-15" max="15" step="0.1" value="' + g +'" ' ;
				myHTML = myHTML + 'onpointerdown="showBubble(this)" onchange="iSlideEQ(this)" id="' + labeltype + i + '" ></Input>';
				myHTML = myHTML + '<output id="' + labeltype + i + 'Bubble" class="bubble" ></output></TD>';
				myHTML = myHTML + '<TD class="rowSuffix"><Output id="val_' + labeltype + i + '">' + g + '</Output>&nbsp;dB</TD>';
				myHTML = myHTML + '</TR>';
				
				i++;
			}
		}
	}
	return (myHTML);
	
}	


function LocalSetupRadio(myRadio, newValue )
{
	
	var radioObj = document.getElementsByName(myRadio);
	//if(!radioObj)
	//	return;
	
	var radioLength = radioObj.length;
	//alert ('processing radio length ' + radioLength);
	if(radioLength == undefined) {
		radioObj.checked = (radioObj.value == newValue.toString());
		return;
	}
	for(var i = 0; i < radioLength; i++) {
		radioObj[i].checked = false;
		//alert('Current: ' + radioObj[i].value + ' New: ' + newValue);
		if(radioObj[i].value == newValue) {
			radioObj[i].checked = true;
		}
	}
	
}



function LocalUpdateSettings (data)
	{
		// Write Data from REST response to Local cache
		UpdateSqueezeDSPData(data);
		
		//Now We display the data from the cache				
		LocalSetupRadio( 'val_Bands' , SqueezeDSPData.Bands);	
		LocalDisplayEQ();	
		LocalDisplayVals();
		ListenForSlide();
	}


function HideAlert()
{
	myMessage.className ="bubble";
	myMessage.innerText = '';
}

function DisplayAlert(FieldName, Message)
{

	myMessage.className  = "localAlert";
	myMessage.innerText = Message + ' ' + FieldName + " ...";
	setTimeout(function(){ 	HideAlert(); }, 1000);	
}

 function SetNewPreset(myEl) 
 
{
	var val = myEl.value;
	SqueezeDSPSavePreset(val, Initialise);
	DisplayAlert ('Preset','Saving')	
		
}



function LocalDisplayEQ()
{
	//alert ('LocalDisplayEQ');
	var myEQ=SqueezeDSPData.EQ_loop;

	document.getElementById('control_EQ').innerHTML = LocalbuildEQ(myEQ, 'Slide');
}

function LocalDisplayVals()
{
		
		
		//alert(document.getElementById('Skew').value +':'+  SqueezeDSPData.Skew);
		DisplayVal('Skew', SqueezeDSPData.Skew);
		DisplayVal('Flatness', SqueezeDSPData.Flatness);
		DisplayVal('Quietness', SqueezeDSPData.Quietness);
		DisplayVal('Balance', SqueezeDSPData.Balance);
		DisplayVal('Width', SqueezeDSPData.Width);
		DisplayVal('AmbRotateX',  SqueezeDSPData.AmbRotateX); 
		DisplayVal('AmbRotateY', SqueezeDSPData.AmbRotateY ); 
		DisplayVal('AmbRotateZ',SqueezeDSPData.AmbRotateZ ); 
		 
		DisplayVal('AmbjW',SqueezeDSPData.AmbjW ); 
		DisplayVal('AmbAngle',SqueezeDSPData.AmbAngle); 
		DisplayVal('AmbDirect',SqueezeDSPData.AmbDirect);
		
		// Set the values for dropdowns
		document.getElementById('sel_Matrix').value = SqueezeDSPData.Matrix;
		document.getElementById('sel_Filter').value = SqueezeDSPData.Filter;
		
		//ambi filter is a bit mroe complex
		var myEl = document.getElementById('sel_Amb');
		myEl.value = SqueezeDSPData.Amb;
		SetAmb( myEl);
					
}


function DisplayVal(ElName, MyVal)
{
		document.getElementById(ElName).value = MyVal;
		document.getElementById('val_' + ElName ).value = MyVal;
}


function iSlide (myObj){
	
	myVal = document.getElementById ('val_' + myObj.id );
	myVal.value = myObj.value;
	document.getElementById(myObj.id + 'Bubble').style.display = 'none';	
	NewFieldValue(myObj.id, myObj, false);
	
}


function iSlideEQ (myObj){
	document.getElementById ('val_' + myObj.id ).value = myObj.value;
	var myGain = document.getElementById ('val_' + myObj.id ).value;
	var myFreq = document.getElementById ('freq_' + myObj.id ).value; 
	var myBand = document.getElementById ('band_' + myObj.id ).value; 
	document.getElementById(myObj.id + 'Bubble').style.display = 'none';
		
	SqueezeDSPSaveEQBand(myBand, myFreq, myGain)	;	
	DisplayAlert (' EQ: ' + myFreq + ' Hz','Setting');	
}


function NewFieldValue(FieldName, myEl, RefreshAfter)
{
	//var myHost = myEl.parentNode.parentNode;
	
	var val = myEl.value;
	
	if (RefreshAfter == true)
	 {
		SqueezeDSPSelectValue (FieldName, val, LocalUpdateSettings);
	 }
	 else
	 {
		SqueezeDSPSelectValue (FieldName, val);
	 }
	DisplayAlert (FieldName,'Setting');
}

function GetCurrentPlayerSettings()
{
	SqueezeDSPSelectValue ('Preset', myPlayer.value, LocalUpdateSettings);
}


function SetAmb(myEl)
{
	
	//NewFieldValue(FieldName, myEl,  false);
	val = myEl.value;
	// Show angle and directivity if this is Crossed or Crossed+jW
	var ctrl = document.getElementById("control_AmbAngle");
	if(ctrl)
	{
		ctrl.style.display = (val=="Crossed" || val=="Crossed+jW") ? "" : "none";
	}
	ctrl = document.getElementById("control_AmbDirect");
	if(ctrl)
	{
		ctrl.style.display = (val=="Crossed" || val=="Crossed+jW") ? "" : "none";
	}
	ctrl = document.getElementById("control_AmbjW");
	if(ctrl)
	{
		ctrl.style.display = (val=="Crossed+jW") ? "" : "none";
	}
}

function Initialise()
{
	SqueezeDSPGetSettings(LocalUpdateSettings);
	SqueezeDSPGetList(LocalBuildLists);
}

//Bubble against sliders
//from Chris Coyier on Mar 26, 2020
//https://css-tricks.com/value-bubbles-for-range-inputs/#update-new-version-with-vanilla-javascript-that-also-works-better

function ListenForSlide()
{
	const allRanges = document.querySelectorAll(".Slide");
	  allRanges.forEach(wrap => {
	  const range = wrap.querySelector(".range");
	  const bubble = wrap.querySelector(".bubble");

	  range.addEventListener("input", () => {
		setBubble(range, bubble);
	  });
	  setBubble(range, bubble);
	});
}


function setBubble(range, bubble) {
  const val = range.value;
  const min = range.min ? range.min : 0;
  const max = range.max ? range.max : 100;

  bubble.innerHTML = val; 		
  
  // get the width of the range slider and multiply by the value as a fraction of the total range
 
  const newVal = (range.offsetWidth * ((val - min) ) / (max - min)) ;
 
  bubble.style.left = `calc(${newVal}px)`;
}

function showBubble(myObj)
{
		
		var myBubble = document.getElementById(myObj.id + 'Bubble');
		//initialise the bubble position
		setBubble (myObj, myBubble);
		// now make it visible
		myBubble.style.display = 'block';
}

//End of Bubble

//END OF Display Logic
/*
SQueezeDSP - DATA

*/
function getCurrentPlayer()
{
   return (playerid);
}

SqueezeDSPData = function()

{
    
	this._EQ_loop = {};

	// Dictionary of lists (rc & matrix filters, presets)
	this.Lists = {};
	this.Matrix = "";
	this.Filter = "";
	this.Preset = "";
	this.AmbRotateX = "12";
	this.AmbRotateY = 0;
	this.AmbRotateZ = 0;
	this.Amb = 0;
	this.AmbjW = 0;
	this.AmbAngle = 0;
	this.AmbDirect = 0;
	this.Bands = 2;
	this.Balance = 0 ;
	this.Skew = 0;
	this.Flatness= 10 ;
	this.Quietness = 0;

}

function UpdateSqueezeDSPData(data)
{
		SqueezeDSPData.AmbRotateX = data.result['AmbRotateX'];
		SqueezeDSPData.AmbRotateY =  data.result['AmbRotateY'];
		SqueezeDSPData.AmbRotateZ =   data.result['AmbRotateZ'];
		SqueezeDSPData.Amb =   data.result['Amb'];
		SqueezeDSPData.AmbjW =   data.result['AmbjW'];
		SqueezeDSPData.AmbAngle =   data.result['AmbAngle'];
		SqueezeDSPData.AmbDirect =   data.result['AmbDirect'];
		SqueezeDSPData.Bands =   data.result['Bands'];
		SqueezeDSPData.Balance =   data.result['Balance'];
		SqueezeDSPData.Skew =   data.result['Skew'];
		SqueezeDSPData.Flatness =   data.result['Flatness'];
		SqueezeDSPData.Quietness =   data.result['Quietness'];
		SqueezeDSPData.Width =   data.result['Width'];
		
		SqueezeDSPData.Matrix = data.result['Matrix'];
		SqueezeDSPData.Filter = data.result['Filter'];
		SqueezeDSPData.Preset = data.result['Preset'];
		
		// Copy EQ_loop
		SqueezeDSPData.EQ_loop = data.result.EQ_loop;

}


function SqueezeDSPGetList(callback)
{
	SilverlightPlugInHost.innerText = '';
	new Ajax.Request('/jsonrpc.js', {
		method: 'post',
		asynchronous: true,
		postBody: Object.toJSON({
			id: 1, 
			method: 'slim.request', 
			params: [
				getCurrentPlayer(), 
				[
					'SqueezeDSP.filters'
				]
			]
		}),

		onFailure: function() { alert('Failed'); },

		onSuccess: function(response) {
			// debugger;
		var data = response.responseText.evalJSON(true);

		callback(data);

		}
	});
}

function SqueezeDSPGetSettings(callback)
{
	new Ajax.Request('/jsonrpc.js', {
		method: 'post',
		asynchronous: true,
		//asynchronous: false,
		postBody: Object.toJSON({
			id: 1, 
			method: 'slim.request', 
			params: [
				getCurrentPlayer(), 
				[
					'SqueezeDSP.current'
				]
			]
		}),

		onFailure: function() { alert('Failed'); },

		onSuccess: function(response) {
			// debugger;
		var data = response.responseText.evalJSON();
		callback(data);
		
		}
	});

}

function SqueezeDSPSelectPreset()
{
	// Save this value (async)
	var myProperty='Preset';
	var myVal = 'Joxy.preset.conf';
	new Ajax.Request('/jsonrpc.js', {
		method: 'post',
		asynchronous: true,
		postBody: Object.toJSON({
			id: 1, 
			method: 'slim.request', 
			params: [
				getCurrentPlayer(), 
				[
					'SqueezeDSP.setval',
					'key:'+myProperty,
					'val:'+myVal
				]
				]
			}),
			onFailure: function() { alert('Failed') },
			onSuccess: function(response) { 	// debugger;
			var data = response.responseText.evalJSON();
			SqueezeDSPGetSettings(LocalUpdateSettings);
			}
		});
	}

function SqueezeDSPSelectValue(myProperty, myVal, callback)
{
	// Save this value (async)
	//var myProperty='Preset';
	//var myVal = 'Joxy.preset.conf';
	//alert (myProperty);
	new Ajax.Request('/jsonrpc.js', {
		method: 'post',
		asynchronous: true,
		postBody: Object.toJSON({
			id: 1, 
			method: 'slim.request', 
			params: [
				getCurrentPlayer(), 
				[
					'SqueezeDSP.setval',
					'key:'+myProperty,
					'val:'+myVal
				]
				]
			}),
			onFailure: function() { alert('Failed') },
			onSuccess: function(response) { 	// debugger;
			var data = response.responseText.evalJSON();
			if(typeof callback !== 'undefined'){
					SqueezeDSPGetSettings(callback);
				};
			//SqueezeDSPGetSettings(LocalUpdateSettings);
			}
		});
	}

function SqueezeDSPSavePreset(myVal, callback)
{
	
	// Save this value (async)
	alert(myVal);
	alert(callback);
	
	new Ajax.Request('/jsonrpc.js', {
		method: 'post',
		asynchronous: true,
		postBody: Object.toJSON({
			id: 1, 
			method: 'slim.request', 
			params: [
				getCurrentPlayer(), 
				[
					'SqueezeDSP.saveas',
					'preset:' + myVal,
				],
			]
		}),
		onFailure: function() { alert('Failed'); },

		onSuccess: function(response) {
			// debugger;
		alert ('Well I tried')		;	
		var data = response.responseText.evalJSON();
		
		callback();
		}	});
}

function SqueezeDSPSaveEQBand(myBand, myFreq, myGain)
{
				
				new Ajax.Request('/jsonrpc.js', {
					method: 'post',
					asynchronous: true,
					postBody: Object.toJSON({
						id: 1, 
						method: 'slim.request', 
						params: [
							getCurrentPlayer(), 
							[
								'SqueezeDSP.seteq',
								'band:'+myBand,
								'freq:'+myFreq,
								'gain:'+myGain
							]
						]
					}),
					onFailure: function() { alert('Failed'); },
					onSuccess: function(response) {
					// debugger;
						var data = response.responseText.evalJSON();
					}
				});
}


/* End of Data*/
</script>

	[% WRAPPER settingSection onmouseover="onHTMLMouseOverBody()" %]
	<!-- the style-police -->
		
	<div>
	<div class="bubble" id="myMessage">To use please select SqueezeDSP on Extras Menu</div>
	<Output>SqueezeDSP Config</Output>
	<Output style="float: right;" id="myPlayer"></Output>
	
	</div>
	<table style="width:100%;padding:0; display:none;" zzz_onresize="resizeContainer()">
		<tr><td>
			<div id="SilverlightPlugInHost" style="margin-right:20px; height:200px; width:95%;"></div>
		</td></tr>
	</table>
<!-- for Testing Rest Calls-->
<!--DIV id="TEST REST" class="table-container" >
	<input type ="Button" onclick="SqueezeDSPGetList(LocalBuildLists)" value="Get List" >
	<input type ="Button" onclick="SqueezeDSPGetSettings(LocalUpdateSettings) " value = "Get Settings" >
	<input type ="Button" onclick="LocalShowSettings() " value = "Show Settings">
	<input type ="Button" onclick="LocalsetValue()" value = "Set Value" >
	<input type ="Button" onclick="LocalSaveEQBand()" value = "Save EQ Band" >
	<input type ="Button" onclick="SqueezeDSPSelectPreset()" value = "Select Preset" >
	<input type ="Button" onclick="Initialise()" value = "Initialise" >

	<input type ="Button" onclick="LocalDisplayEQ()" value="Display EQ Sliders" >
	<input type ="Button" onclick="SilverlightPlugInHost.innerText = checkInguzLib();" value = "Check Inguz" >	
	<input type ="Button" onclick="control_NewPreset.className='Boring';" value = "Reset Animation" >
</DIV--!>
	<!-- settings fields -->
	<!--PRESETS-->
	[% WRAPPER settingSection %]&nbsp;
	[% WRAPPER settingGroup title="PLUGIN_SQUEEZEDSP_HTML_PRESETS" %][% END %]
	<TABLE class="table-container" >
		<TR  id="control_Preset">
			<TD class="rowTitleLong"><Output class="songInfoTitle">[% "PLUGIN_SQUEEZEDSP_CHOOSE_PRESET" | string %]</a></Output></TD>
			<TD class="rowBody">
				<select class="sqdsp-select" id="sel_Preset" onchange="edt_NewPreset.value = this.value.replace('.preset.conf',''); NewFieldValue('Preset', this, true); "  >
					<option value="-">None</option>
				</select>
			</TD>
		</TR>

		<TR id="control_NewPreset">
			<TD class="rowTitleLong"><Output class="songInfoTitle">[% "PLUGIN_SQUEEZEDSP_SAVEPRESETFILE" | string %]</Output></TD>
			<TD class="rowBody">
				<input class="sqdsp-edit" id="edt_NewPreset" value="None" />								
				<input class="sqdsp-click" type="button" name="btn_NewPreset" value="Save" onclick="SetNewPreset(edt_NewPreset);" </input></TD>
		</TR>
	</TABLE>	
	[% END %]
		
	<!--Convolver Type Filters -->
	[% WRAPPER settingSection %]&nbsp;
		[% WRAPPER settingGroup title="PLUGIN_SQUEEZEDSP_HTML_FILTERS" %][% END %]
	<TABLE class="table-container" >
		<TR id="control_Filter">
			<TD class="rowTitleLong"><Output  class="songInfoTitle">[% "PLUGIN_SQUEEZEDSP_ROOMCORR" | string %]</a></Output></TD>
			<TD class="rowBody">
				<select class="sqdsp-select" id="sel_Filter" onchange="NewFieldValue('Filter', this, false)" >
					<option value="-">None</option>
				</select>
			</TD>
		</TR>

		<TR id="control_Matrix">
			<TD class="rowTitleLong"><Output  class="songInfoTitle">[% "PLUGIN_SQUEEZEDSP_MATRIX" | string %]</a></Output></TD>
			<TD class="rowBody">
				<select class="sqdsp-select" id="sel_Matrix" onchange="NewFieldValue('Matrix', this, false)" >
					<option value="-">None</option>
				</select>
			</TD>
		</TR>
	</TABLE>
	[% END %]
	
	<!--EQ Selector -->
	[% WRAPPER settingSection %]&nbsp;
		[% WRAPPER settingGroup title="PLUGIN_SQUEEZEDSP_CHOOSE_EQSETTINGS" %][% END %]
	<TABLE class="table-container"   >
		<TR  id="control_Bands">
			<TD class="rowTitle">

				<label for="val_Bands">[% "PLUGIN_SQUEEZEDSP_EQUALIZER" | string %]</label>
			</TD>
				<TD><input type="radio" name="val_Bands" value="2"  onclick="NewFieldValue ('Bands', this, true);">&emsp;<Output> 2 [% "PLUGIN_SQUEEZEDSP_NBAND" | string %]</Output></input></TD>
				<TD><input type="radio" name="val_Bands" value="3"  onclick="NewFieldValue ('Bands', this, true);">&emsp;<Output>   3 [% "PLUGIN_SQUEEZEDSP_NBAND" | string %]</Output></input></TD>
				<TD><input type="radio" name="val_Bands" value="5"  onclick="NewFieldValue ('Bands', this, true);">&emsp;<Output>   5 [% "PLUGIN_SQUEEZEDSP_NBAND" | string %]</Output></input></TD>
				<TD><input type="radio" name="val_Bands" value="9"  onclick="NewFieldValue ('Bands', this, true);"> &emsp;<Output>   9 [% "PLUGIN_SQUEEZEDSP_NBAND" | string %]</Output></input></TD>
				<TD><input type="radio" name="val_Bands" value="15" onclick="NewFieldValue ('Bands', this, true);"> &emsp;<Output>  15 [% "PLUGIN_SQUEEZEDSP_NBAND" | string %]</Output></input></TD>
				<TD><input type="radio" name="val_Bands" value="31" onclick="NewFieldValue ('Bands', this, true);"> &emsp;<Output>  31 [% "PLUGIN_SQUEEZEDSP_NBAND" | string %]</Output></input></TD>
			
			
		</TR>
	</TABLE>
	[% END %]
	
	<!--Equalizer -->
	[% WRAPPER settingSection %]&nbsp;
		[% WRAPPER settingGroup title="PLUGIN_SQUEEZEDSP_HTML_EQ" %][% END %]
		<TABLE id="control_EQ" class="table-container" >
			<!-- This stuff will all be replaced by new EQ -->	
		</TABLE>
	[% END %]
	
	<!--Balance / Quietness etc -->
	[% WRAPPER settingSection %]&nbsp;
		[% WRAPPER settingGroup title="PLUGIN_SQUEEZEDSP_HTML_AUDIO" %][% END %]
	<TABLE class="table-container" >
		<TR id="control_Flatness" inc="1">
			 <TD class="rowTitle"><Output class="songInfoTitle">[% "PLUGIN_SQUEEZEDSP_FLATNESS" | string %]</a></Output></TD>
			 <TD class="Slide">
				<input  class="range" type="range"   orient="horizontal"  min="0" max="10" step="1" value="0" onpointerdown="showBubble(this)" onchange="iSlide(this)" id="Flatness" ></Input>
				<output id="FlatnessBubble" class="bubble" ></output></TD>
		
				
			<TD class="rowSuffix"><Output id="val_Flatness"></Output>&nbsp;</TD>
			
		</TR>
		<TR id="control_Quietness" inc="1">
			<TD class="rowTitle"><Output class="songInfoTitle">[% "PLUGIN_SQUEEZEDSP_QUIETNESS" | string %]</a></Output></TD>
			 <TD class="Slide">
				<output id="QuietnessBubble" class="bubble" ></output>
				<input  class="range" type="range"   orient="horizontal"  min="0" max="10" step="1" value="0" onpointerdown="showBubble(this)" onchange="iSlide(this)" id="Quietness" ></Input>
				
			 </TD>
			 	
			 <TD class="rowSuffix"><Output id="val_Quietness"></Output>&nbsp;</TD>
		</TR>

		<TR id="control_Balance" inc="0.1">
			<TD class="rowTitle"><Output class="songInfoTitle">[% "PLUGIN_SQUEEZEDSP_BALANCE" | string %]</a></Output></TD>
			<TD class="Slide">
					<input  class="range" type="range"   orient="horizontal"  min="-9" max="9" step="0.1" value="0" onpointerdown="showBubble(this)" onchange="iSlide(this)" id="Balance" ></Input>
					<output id="BalanceBubble" class="bubble" ></output>
			 </TD>
			<TD class="rowSuffix"><Output  id="val_Balance"></span>&nbsp;[% "PLUGIN_SQUEEZEDSP_DECIBELS" | string %]</TD>
		</TR>

		<TR id="control_Width" inc="0.1">
			<TD class="rowTitle"><Output class="songInfoTitle">[% "PLUGIN_SQUEEZEDSP_WIDTH" | string %]</a></Output></TD>
			
			 <TD class="Slide">
					<input  class="range" type="range"   orient="horizontal"  min="-9" max="9" step="0.1" value="0" onpointerdown="showBubble(this)" onchange="iSlide(this)" id="Width" ></Input>
					<output id="WidthBubble" class="bubble" ></output>
			</TD>	
			 <TD class="rowSuffix"><Output id="val_Width"></Output>&nbsp;[% "PLUGIN_SQUEEZEDSP_DECIBELS" | string %]</TD>
		</TR>
	</TABLE>
	[% END %]

	<!--Advanced -->
	[% WRAPPER settingSection %]&nbsp;
		[% WRAPPER settingGroup title="PLUGIN_SQUEEZEDSP_HTML_ADVANCED" %][% END %]
	<TABLE class="table-container" >
	 <TR id="control_Skew">  
		
	    <TD class="rowTitle"><Output class="songInfoTitle">[% "PLUGIN_SQUEEZEDSP_SKEW" | string %]</a></Output> </TD >
		
		<TD class="Slide">
			<input  class="range" type="range"   orient="horizontal"  min="-100" max="100" step="1" value="0" onpointerdown="showBubble(this)" onchange="iSlide(this)" id="Skew" ></Input>
			<output id="SkewBubble" class="bubble" ></output>
		</TD>
		<TD class="rowSuffix"><Output id="val_Skew" ></Output>&nbsp;[% "PLUGIN_SQUEEZEDSP_SAMPLES" | string %]</TD >
	 </TR>
	 </Table>
	<TABLE class="table-container" >
	<TR id="control_Amb">
			<TD class="rowTitleLong"><Output class="songInfoTitle">[% "PLUGIN_SQUEEZEDSP_AMBI_DECODE" | string %]</a></Output></TD>
			<TD class="rowBody">
				<select class="sqdsp-select" id="sel_Amb"  onchange= "NewFieldValue('Amb', this, false); SetAmb( this)" >
					<option value="UHJ">[% "PLUGIN_SQUEEZEDSP_AMBI_UHJ" | string %]</option>
					<option value="Blumlein">[% "PLUGIN_SQUEEZEDSP_AMBI_BLUMLEIN" | string %]</option>
					<option value="Crossed">[% "PLUGIN_SQUEEZEDSP_AMBI_CARDIOID" | string %]</option>
<!--
					<option value="Crossed+jW">[% "PLUGIN_SQUEEZEDSP_AMBI_CARDIOID_PLUSJW" | string %]</option>
-->
				</select>
			</TD>
		</TR>
	</TABLE>
	<TABLE class="table-container" >
		<TR id="control_AmbAngle" inc="5" style="display:none">
			<TD class="rowTitle"><Output  class="songInfoTitle">[% "PLUGIN_SQUEEZEDSP_AMBI_CARDIOID_ANGLE" | string %]</Output> </TD >
			<TD class="Slide">
				<input  class="range" type="range"   orient="horizontal"  min="45" max="150" step="5" value="0" onpointerdown="showBubble(this)" onchange="iSlide(this)" id="AmbAngle" ></Input>
				<output id="AmbAngleBubble" class="bubble" ></output>
			</TD>
		
		<TD class="rowSuffix"><Output id="val_AmbAngle"></Output>&nbsp;[% "PLUGIN_SQUEEZEDSP_DEGREES" | string %]
			</TD >
		</TR>
		<TR id="control_AmbDirect" inc="0.1" style="display:none">
			<TD class="rowTitle"><Output  class="songInfoTitle">[% "PLUGIN_SQUEEZEDSP_AMBI_CARDIOID_DIRECT" | string %]</Output> </TD >
			<TD class="Slide">
				<input  class="range" type="range"   orient="horizontal"  min="0" max="1" step="0.1" value="0" onpointerdown="showBubble(this)" onchange="iSlide(this)" id="AmbDirect" ></Input>
				<output id="AmbDirectBubble" class="bubble" ></output>
			</TD>
			
			<TD class="rowSuffix"><Output id="val_AmbDirect"></Output>&nbsp;
			</TD >
		</TR>

		<TR id="control_AmbjW" inc="0.05" style="display:none">
			<TD class="rowTitle"><Output  class="songInfoTitle">[% "PLUGIN_SQUEEZEDSP_AMBI_CARDIOID_JW" | string %]</Output> </TD >
			<TD class="Slide">
				<input  class="range" type="range"   orient="horizontal"  min="0" max="1" step="0.05" value="0" onpointerdown="showBubble(this)" onchange="iSlide(this)" id="AmbjW" ></Input>
				<output id="AmbjWBubble" class="bubble" ></output>
			</TD>
			<TD class="rowSuffix"><Output id="val_AmbjW"></Output>&nbsp;
			</TD >
		</TR>

		<TR id="control_AmbRotateZ" inc="1">
			<TD class="rowTitle"><Output  class="songInfoTitle">[% "PLUGIN_SQUEEZEDSP_AMBI_ROTATION" | string %]</Output> </TD >
			<TD class="Slide">
				<input  class="range" type="range"   orient="horizontal"  min="-90" max="90" step="1" value="0" onpointerdown="showBubble(this)" onchange="iSlide(this)" id="AmbRotateZ" ></Input>
				<output id="AmbRotateZBubble" class="bubble" ></output>
			</TD>
			<TD class="rowSuffix"><Output id="val_AmbRotateZ"></Output>&nbsp;[% "PLUGIN_SQUEEZEDSP_DEGREES" | string %]&nbsp;-&nbsp;[% "PLUGIN_SQUEEZEDSP_AMBI_ROTATION_Z" | string %]
			</TD >
		</TR>
		<TR id="control_AmbRotateY" inc="1">
			<TD class="rowTitle"><Output  class="songInfoTitle"></Output> </TD >
			<TD class="Slide">
				<input  class="range" type="range"   orient="horizontal"  min="-90" max="90" step="1" value="0" onpointerdown="showBubble(this)" onchange="iSlide(this)" id="AmbRotateY" ></Input>
				<output id="AmbRotateYBubble" class="bubble" ></output>
			</TD>
			<TD class="rowSuffix"><Output id="val_AmbRotateY"></Output>&nbsp;[% "PLUGIN_SQUEEZEDSP_DEGREES" | string %]&nbsp;-&nbsp;[% "PLUGIN_SQUEEZEDSP_AMBI_ROTATION_Y" | string %]
			</TD >
		</TR>
		<TR id="control_AmbRotateX" inc="1">
			<TD class="rowTitle"><Output  class="songInfoTitle"></Output> </TD >
			<TD class="Slide">
				<input  class="range" type="range"   orient="horizontal"  min="-90" max="90" step="1" value="0" onpointerdown="showBubble(this)" onchange="iSlide(this)" id="AmbRotateX" ></Input>
				<output id="AmbRotateXBubble" class="bubble" ></output>
			</TD>
			<TD class="rowSuffix"><Output id="val_AmbRotateX"></Output>&nbsp;[% "PLUGIN_SQUEEZEDSP_DEGREES" | string %]&nbsp;-&nbsp;[% "PLUGIN_SQUEEZEDSP_AMBI_ROTATION_X" | string %]
			</TD >
		</TR>
	</TABLE>	
	[% END %]


	<!-- end of page -->
	[% END %]

<script>
myPlayer.value = playerid;
//myPlayerName.value = 'Donkey'; //player_name;
window.setTimeout( function() {
	Initialise();
	GetCurrentPlayerSettings();
},500);


</script>

[% PROCESS pagefooter.html %]
